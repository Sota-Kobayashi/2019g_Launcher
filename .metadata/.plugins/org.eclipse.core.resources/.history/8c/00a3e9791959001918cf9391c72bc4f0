/*
 * move_angle.cpp
 *
 *  Created on: 2019/04/06
 *      Author: User
 */
#include <move_angle.hpp>
#include <string>
#include <uart.hpp>

void MoveAngle::switchControl_()
{
	if(!upSig.readNowState())
	{
		PositionPID::SetSpeed(10, MotorDriver::MotorDriveMode::PID);
	}
	else if(!downSig.readNowState())
	{
		PositionPID::SetSpeed(-10, MotorDriver::MotorDriveMode::PID);
	}
	else
	{
		PositionPID::SetSpeed(0, MotorDriver::MotorDriveMode::DutyControl);
	}
}
void MoveAngle::zeroPointIntrrupt_()
{
	if(isGotZeroPoint_)return;
	PositionPID::SetSpeed(0, MotorDriver::MotorDriveMode::DutyControl);
	PositionPID::setPositionCount((int32_t)movePositions::downPosition);
	isGotZeroPoint_ = true;
}
void MoveAngle::moveAngle_Update()
{
	uartSendString(std::to_string(PositionPID::readPositionCount<int32_t>()) + '\n');

	switchControl_();

	if(!upSig.readNowState() || !downSig.readNowState())
	{
		PositionPID::setEnableState(false);
	}
	else
	{


		if(!isGotZeroPoint_)
		{
			//getZeroPoint_();
		}

		if(emergencySwitch.readNowState() && isGotZeroPoint_)
		{
			//PositionPID::setEnableState(true);
		}
		else
		{
			PositionPID::setEnableState(false);
		}
	}
}



